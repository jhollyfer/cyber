# Diretorio `bin/`

## Visao Geral

O diretorio `bin/` contem o ponto de entrada da aplicacao. Possui um unico arquivo responsavel por iniciar o servidor HTTP.

---

## Estrutura

```
bin/
  server.ts    # Ponto de entrada da aplicacao
```

---

## `bin/server.ts`

Este arquivo e o primeiro a ser executado quando a aplicacao inicia. Ele importa as variaveis de ambiente e o kernel Fastify, e inicia o servidor HTTP.

### Codigo fonte

```typescript
import { Env } from '@start/env';
import { kernel } from '@start/kernel';

kernel.listen({ port: Env.PORT, host: '0.0.0.0' }).then(() => {
  console.info(`HTTP Server running on http://localhost:${Env.PORT}`);
});
```

### Fluxo de execucao

```
1. Importa Env (valida variaveis de ambiente via Zod)
2. Importa kernel (instancia Fastify com todos os plugins, DI e controllers registrados)
3. kernel.listen()
     port: Env.PORT (padrao: 4000)
     host: '0.0.0.0' (aceita conexoes de qualquer interface)
4. Loga a mensagem de sucesso no console
```

### Detalhes

- O Prisma e inicializado em `config/database.ts` como singleton, importado pelos repositorios conforme necessario. Nao ha etapa de conexao explicita como em ORMs tradicionais.
- **`kernel.listen()`**: Inicia o servidor HTTP. O host `0.0.0.0` permite que o servidor aceite conexoes de qualquer interface de rede (necessario para uso em containers Docker).

---

## Scripts npm

### Desenvolvimento

```bash
npm run dev
```

Executa:
```bash
node --import @swc-node/register/esm-register --watch bin/server.ts
```

- `--import @swc-node/register/esm-register`: Registra o SWC como compilador TypeScript em tempo real, com suporte a ESM
- `--watch`: Reinicia automaticamente o servidor ao detectar mudancas nos arquivos

### Producao

```bash
npm start
```

Executa:
```bash
node build/bin/server.js
```

- Executa o codigo ja compilado pelo tsup no diretorio `build/`

### Build

```bash
npm run build
```

Executa:
```bash
tsc -b && tsup
```

- `tsc -b`: Verifica tipos TypeScript (type-checking apenas, sem emitir)
- `tsup`: Empacota o codigo para producao em formato ESM, target ES2024, saida em `build/`

---

## Dependencias

O `bin/server.ts` depende de:

| Import | Origem | Funcao |
|---|---|---|
| `Env` | `@start/env` | Variaveis de ambiente validadas |
| `kernel` | `@start/kernel` | Instancia do Fastify configurada |

---

## Variaveis de ambiente utilizadas

| Variavel | Descricao | Padrao |
|---|---|---|
| `PORT` | Porta do servidor HTTP | `4000` |
