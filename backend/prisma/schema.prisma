generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMINISTRATOR
  STUDENT
}

model User {
  id            String        @id @default(uuid())
  name          String
  phone         String        @unique
  password      String
  role          Role          @default(STUDENT)
  active        Boolean       @default(true)
  created_at    DateTime      @default(now()) @map("created_at")
  updated_at    DateTime      @updatedAt @map("updated_at")

  game_sessions GameSession[]

  @@map("users")
}

model Module {
  id                String     @id @default(uuid())
  title             String
  description       String     @db.Text
  icon              String
  label             String
  order             Int        @default(0)
  time_per_question Int?       @default(60) @map("time_per_question")
  gradient          String     @default("purple")
  category_color    String     @default("purple") @map("category_color")
  active            Boolean    @default(true)
  created_at        DateTime   @default(now()) @map("created_at")
  updated_at        DateTime   @updatedAt @map("updated_at")
  deleted_at        DateTime?  @map("deleted_at")

  questions     Question[]
  game_sessions GameSession[]

  @@map("modules")
}

model Question {
  id           String   @id @default(uuid())
  question     String   @db.Text
  options      Json
  correct      Int
  explanation  String   @db.Text
  category     String
  context      String?
  order        Int      @default(0)
  active       Boolean  @default(true)
  created_at   DateTime @default(now()) @map("created_at")
  updated_at   DateTime @updatedAt @map("updated_at")
  deleted_at   DateTime? @map("deleted_at")

  module_id    String   @map("module_id")
  module       Module   @relation(fields: [module_id], references: [id], onDelete: Cascade)

  answers      Answer[]

  @@map("questions")
}

model GameSession {
  id               String    @id @default(uuid())
  score            Int       @default(0)
  correct_answers  Int       @default(0) @map("correct_answers")
  total_answered   Int       @default(0) @map("total_answered")
  streak           Int       @default(0)
  max_streak       Int       @default(0) @map("max_streak")
  nota             Decimal?  @db.Decimal(5, 3)
  finished         Boolean   @default(false)
  is_best          Boolean   @default(false) @map("is_best")
  created_at       DateTime  @default(now()) @map("created_at")
  updated_at       DateTime  @updatedAt @map("updated_at")
  finished_at      DateTime? @map("finished_at")

  user_id          String    @map("user_id")
  user             User      @relation(fields: [user_id], references: [id])

  module_id        String    @map("module_id")
  module           Module    @relation(fields: [module_id], references: [id])

  answers          Answer[]

  @@map("game_sessions")
}

model Answer {
  id              String      @id @default(uuid())
  selected_option Int         @map("selected_option")
  is_correct      Boolean     @map("is_correct")
  points          Int         @default(0)
  time_spent      Int         @default(0) @map("time_spent")
  created_at      DateTime    @default(now()) @map("created_at")

  session_id      String      @map("session_id")
  session         GameSession @relation(fields: [session_id], references: [id], onDelete: Cascade)

  question_id     String      @map("question_id")
  question        Question    @relation(fields: [question_id], references: [id])

  @@unique([session_id, question_id])
  @@map("answers")
}
